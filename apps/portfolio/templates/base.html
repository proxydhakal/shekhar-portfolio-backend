{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if site_config.meta_title %}{{ site_config.meta_title }}{% else %}{{ profile.name|default:"Shekhar Dhakal" }} | Python Developer & RPA Specialist{% endif %}</title>
    <meta name="description" content="{{ site_config.meta_description|default:'Portfolio of Shekhar Dhakal, Backend Engineer & RPA Specialist.' }}">
    <meta name="keywords" content="{{ site_config.meta_keywords|default:'backend, rpa, python, django, devops' }}">
    {% block favicon %}
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon-16x16.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-touch-icon.png' %}">
    {% endblock %}
    <script>
        (function() {
            var isDark = localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            document.documentElement.classList.toggle('dark', isDark);
            var r = document.documentElement;
            if (isDark) {
                r.style.setProperty('--nav-bg', 'rgba(15, 23, 42, 0.98)');
                r.style.setProperty('--mobile-menu-bg', '#0f172a');
                r.style.setProperty('--mobile-link-color', '#e2e8f0');
                r.style.setProperty('--mobile-contact-color', '#94a3b8');
                r.style.setProperty('--mobile-header-color', '#94a3b8');
                r.style.setProperty('--mobile-border-color', 'rgba(255,255,255,0.12)');
            } else {
                r.style.setProperty('--nav-bg', 'rgba(255, 255, 255, 0.98)');
                r.style.setProperty('--mobile-menu-bg', '#ffffff');
                r.style.setProperty('--mobile-link-color', '#0f172a');
                r.style.setProperty('--mobile-contact-color', '#475569');
                r.style.setProperty('--mobile-header-color', '#64748b');
                r.style.setProperty('--mobile-border-color', '#e2e8f0');
            }
        })();
    </script>
    <link rel="stylesheet" href="{% static 'css/dist/output.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js"></script>
    <script>
        document.addEventListener('alpine:init', function() {
            window.Alpine.data('navbar', function() {
                return {
                    mobileOpen: false,
                    init: function() {
                        var self = this;
                        this.$watch('mobileOpen', function(v) {
                            document.body.style.overflow = v ? 'hidden' : 'auto';
                            self.$nextTick(function() { if (window.lucide && window.lucide.createIcons) window.lucide.createIcons(); });
                        });
                        this.$nextTick(function() { if (window.lucide && window.lucide.createIcons) window.lucide.createIcons(); });
                    }
                };
            });
        });
    </script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        .dark ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #6366f1, #10b981);
            border-radius: 10px;
        }
        #bg-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none; opacity: 0.12;
        }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.06);
        }
        .dark .glass {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .gradient-text {
            background: linear-gradient(90deg, #6366f1, #a855f7, #10b981, #6366f1);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 4s linear infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }
        .float { animation: float 6s ease-in-out infinite; }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        [x-cloak] { display: none !important; }
        .terminal-header {
            background: rgba(30, 41, 59, 0.8);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        /* Theme-based nav and mobile menu backgrounds */
        .nav-bar {
            background: var(--nav-bg, rgba(255, 255, 255, 0.98));
        }
        html.dark .nav-bar {
            background: var(--nav-bg, rgba(15, 23, 42, 0.98));
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-slate-50 dark:bg-darkBg text-slate-900 dark:text-slate-100 transition-colors duration-500 font-sans overflow-x-hidden">

    <canvas id="bg-canvas"></canvas>

    <div x-data="navbar()" x-init="init()" class="relative">
        <nav class="nav-bar fixed top-0 w-full z-[100] backdrop-blur-md border-b border-slate-200 dark:border-white/10 shadow-sm dark:shadow-none transition-colors duration-300">
            <div class="max-w-7xl mx-auto px-4 sm:px-6">
                <div class="h-14 sm:h-16 flex justify-between items-center gap-3">
                    <div class="flex items-center gap-3 min-w-0 flex-1">
                        <a href="{% url 'index' %}" class="text-lg sm:text-xl font-mono font-bold tracking-tighter text-slate-900 dark:text-white shrink-0">
                            <span class="text-primary">&lambda;</span> {{ profile.name|default:"Shekhar"|slice:":7"|upper }}.<span class="text-accent">PY</span>
                        </a>
                        <nav aria-label="Breadcrumb" class="hidden sm:block truncate">
                            {% block breadcrumb %}
                            <ol class="flex flex-wrap items-center gap-1.5 text-xs font-mono text-slate-500 dark:text-slate-400">
                                <li><a href="{% url 'index' %}" class="hover:text-primary transition-colors">Home</a></li>
                                {% block breadcrumb_items %}{% endblock %}
                            </ol>
                            {% endblock %}
                        </nav>
                    </div>
                    <div class="hidden md:flex items-center space-x-8 font-mono text-sm text-slate-700 dark:text-slate-200 shrink-0">
                        <a href="{% url 'index' %}#about" class="hover:text-primary transition-colors">About</a>
                        <a href="{% url 'index' %}#skills" class="hover:text-primary transition-colors">Skills</a>
                        <a href="{% url 'index' %}#projects" class="hover:text-primary transition-colors">Projects</a>
                        <a href="{% url 'index' %}#experience" class="hover:text-primary transition-colors">Exp</a>
                        <a href="{% url 'blog_list' %}" class="hover:text-primary transition-colors">Blog</a>
                        <button id="theme-toggle" type="button" class="p-2 rounded-xl bg-slate-100 dark:bg-white/10 hover:scale-110 text-slate-700 dark:text-slate-200">
                            <i data-lucide="moon" id="theme-icon"></i>
                        </button>
                    </div>
                    <div class="flex items-center gap-2 md:hidden shrink-0">
                        <nav aria-label="Breadcrumb" class="sm:hidden truncate max-w-[140px]">
                            {% block breadcrumb_mobile %}
                            <ol class="flex items-center gap-1 text-[10px] font-mono text-slate-500 dark:text-slate-400">
                                <li><a href="{% url 'index' %}" class="hover:text-primary">Home</a></li>
                                {% block breadcrumb_mobile_items %}{% endblock %}
                            </ol>
                            {% endblock %}
                        </nav>
                        <button id="mobile-theme-toggle" type="button" class="p-2 rounded-lg bg-slate-100 dark:bg-white/10 text-slate-700 dark:text-slate-200 md:hidden"><i data-lucide="moon"></i></button>
                        <button @click="mobileOpen = !mobileOpen" type="button" class="p-2 z-[110] relative focus:outline-none text-primary" aria-label="Toggle menu">
                            <i data-lucide="terminal" class="w-6 h-6 sm:w-8 sm:h-8" x-show="!mobileOpen"></i>
                            <i data-lucide="x" class="w-6 h-6 sm:w-8 sm:h-8" x-show="mobileOpen" x-cloak style="display: none;"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Mobile menu backdrop -->
        <div x-show="mobileOpen" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-150" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" @click="mobileOpen = false" class="fixed inset-0 z-[104] bg-black/40 md:hidden" style="display: none;" aria-hidden="true"></div>

        <!-- Mobile menu panel (Alpine.js) -->
        <div x-show="mobileOpen" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0" x-transition:leave="transition ease-in duration-150" x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full" class="fixed top-0 right-0 bottom-0 z-[105] w-full max-w-[280px] flex flex-col pt-14 px-4 pb-6 overflow-y-auto md:hidden shadow-2xl" style="display: none; background-color: var(--mobile-menu-bg, #ffffff);" role="dialog" aria-label="Main menu" aria-modal="true">
            <p class="mb-3 px-1 font-mono text-[10px] uppercase tracking-wider opacity-70 mobile-header" style="color: var(--mobile-header-color, #64748b);">Menu</p>
            <a href="{% url 'index' %}#about" @click="mobileOpen = false" class="mobile-link text-sm font-semibold font-mono w-full py-2.5 px-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" style="color: var(--mobile-link-color, #0f172a);"><span class="text-primary mr-2">01.</span>About</a>
            <a href="{% url 'index' %}#skills" @click="mobileOpen = false" class="mobile-link text-sm font-semibold font-mono w-full py-2.5 px-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" style="color: var(--mobile-link-color, #0f172a);"><span class="text-primary mr-2">02.</span>Skills</a>
            <a href="{% url 'index' %}#projects" @click="mobileOpen = false" class="mobile-link text-sm font-semibold font-mono w-full py-2.5 px-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" style="color: var(--mobile-link-color, #0f172a);"><span class="text-primary mr-2">03.</span>Projects</a>
            <a href="{% url 'index' %}#experience" @click="mobileOpen = false" class="mobile-link text-sm font-semibold font-mono w-full py-2.5 px-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" style="color: var(--mobile-link-color, #0f172a);"><span class="text-primary mr-2">04.</span>Experience</a>
            <a href="{% url 'index' %}#contact" @click="mobileOpen = false" class="mobile-link text-sm font-semibold font-mono w-full py-2.5 px-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" style="color: var(--mobile-link-color, #0f172a);"><span class="text-primary mr-2">05.</span>Contact</a>
            <a href="{% url 'blog_list' %}" @click="mobileOpen = false" class="mobile-link text-sm font-semibold font-mono w-full py-2.5 px-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" style="color: var(--mobile-link-color, #0f172a);"><span class="text-primary mr-2">06.</span>Blog</a>
            <div class="mt-5 pt-4 border-t w-full font-mono text-xs mobile-contact leading-relaxed" style="border-color: var(--mobile-border-color, #e2e8f0); color: var(--mobile-contact-color, #475569);">
                <p class="truncate" title="{{ site_config.email|default:'' }}">{{ site_config.email|default:"" }}</p>
                <p>{{ site_config.phone|default:"" }}</p>
            </div>
        </div>
    </div>

    {% block content %}
    {% endblock %}

    <footer class="pt-32 pb-12 px-6 border-t border-slate-200 dark:border-white/5">
        <div class="max-w-7xl mx-auto text-center">
            <div class="mb-20">
                <h3 class="text-2xl font-bold font-mono mb-4 text-slate-900 dark:text-white">Join the Newsletter</h3>
                <p class="text-slate-600 dark:text-slate-500 font-mono text-xs mb-8">Periodic logs about RPA, Python, and system architecture.</p>
                <form method="post" action="{% url 'index' %}" class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
                    {% csrf_token %}
                    <input type="hidden" name="subscribe_newsletter" value="true">
                    <input type="email" name="email" required placeholder="dev@example.com" class="flex-1 glass px-6 py-4 rounded-2xl outline-none border-none font-mono text-xs text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400 bg-white/50 dark:bg-transparent" aria-label="Email for newsletter">
                    <button type="submit" class="bg-primary px-8 py-4 rounded-2xl font-bold font-mono text-xs text-white hover:opacity-90 transition-opacity">SUBSCRIBE</button>
                </form>
            </div>
            <div class="flex flex-col md:flex-row justify-between items-center gap-6 pt-12 border-t border-slate-200 dark:border-white/5 font-mono text-[10px] text-slate-600 dark:text-slate-500 uppercase tracking-widest">
                <p class="text-slate-700 dark:text-slate-400">&copy; {% now "Y" %} {{ profile.name|default:"Shekhar Dhakal" }} // Pythonic Portfolio</p>
                <div class="flex space-x-8 text-slate-700 dark:text-slate-400">
                    {% if site_config.github_link %}<a href="{{ site_config.github_link }}" class="hover:text-primary transition-colors">Github</a>{% endif %}
                    {% if site_config.linkedin_link %}<a href="{{ site_config.linkedin_link }}" class="hover:text-primary transition-colors">Linkedin</a>{% endif %}
                    <button id="back-to-top" class="hover:text-primary dark:hover:text-white transition-colors">TOP_OF_PAGE</button>
                </div>
            </div>
        </div>
    </footer>

    <script>
        lucide.createIcons();
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, columns;
        const fontSize = 16;
        const drops = [];
        const chars = '01 def class import yield await async django fastapi robocorp'.split(' ');
        function initCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            columns = Math.floor(width / fontSize);
            for (let i = 0; i < columns; i++) drops[i] = Math.random() * -100;
        }
        function draw() {
            ctx.fillStyle = document.documentElement.classList.contains('dark') ? 'rgba(2, 6, 23, 0.05)' : 'rgba(248, 250, 252, 0.05)';
            ctx.fillRect(0, 0, width, height);
            ctx.fillStyle = '#6366f1';
            ctx.font = fontSize + 'px "Fira Code", monospace';
            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(text, i * fontSize * 3, drops[i] * fontSize);
                if (drops[i] * fontSize > height && Math.random() > 0.975) drops[i] = 0;
                drops[i] += 0.5;
            }
        }
        window.addEventListener('resize', initCanvas);
        initCanvas();
        setInterval(draw, 50);
        const themeToggles = [document.getElementById('theme-toggle'), document.getElementById('mobile-theme-toggle')].filter(Boolean);
        const html = document.documentElement;
        function applyTheme(isDark) {
            html.classList.toggle('dark', isDark);
            var r = document.documentElement;
            if (isDark) {
                r.style.setProperty('--nav-bg', 'rgba(15, 23, 42, 0.98)');
                r.style.setProperty('--mobile-menu-bg', '#0f172a');
                r.style.setProperty('--mobile-link-color', '#e2e8f0');
                r.style.setProperty('--mobile-contact-color', '#94a3b8');
                r.style.setProperty('--mobile-header-color', '#94a3b8');
                r.style.setProperty('--mobile-border-color', 'rgba(255,255,255,0.12)');
            } else {
                r.style.setProperty('--nav-bg', 'rgba(255, 255, 255, 0.98)');
                r.style.setProperty('--mobile-menu-bg', '#ffffff');
                r.style.setProperty('--mobile-link-color', '#0f172a');
                r.style.setProperty('--mobile-contact-color', '#475569');
                r.style.setProperty('--mobile-header-color', '#64748b');
                r.style.setProperty('--mobile-border-color', '#e2e8f0');
            }
            const icon = isDark ? 'sun' : 'moon';
            document.querySelectorAll('#theme-icon, #mobile-theme-toggle i').forEach(i => { if (i) i.setAttribute('data-lucide', icon); });
            lucide.createIcons();
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
        themeToggles.forEach(btn => btn.addEventListener('click', () => applyTheme(!html.classList.contains('dark'))));
        var isDarkInitial = localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
        applyTheme(isDarkInitial);
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('active'); });
        }, { threshold: 0.1 });
        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        const backToTop = document.getElementById('back-to-top');
        if (backToTop) backToTop.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
