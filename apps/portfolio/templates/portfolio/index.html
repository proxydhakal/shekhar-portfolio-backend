{% extends 'base.html' %}
{% load static %}
{% load portfolio_tags %}

{% block content %}
    <section class="relative min-h-screen flex items-center justify-center pt-20 px-6">
        <div class="max-w-5xl mx-auto text-center z-10">
            <div class="reveal inline-block px-4 py-1 mb-8 glass rounded-full text-[10px] font-mono font-bold text-accent tracking-[0.2em] uppercase">
                &gt; {{ profile.hero_subtitle|default:"python developer --rpa-specialist" }}
            </div>
            <h1 class="reveal text-6xl md:text-[120px] font-extrabold mb-8 leading-none tracking-tighter">
                {{ profile_first_name }} <br> <span class="gradient-text">{{ profile_last_name }}</span>
            </h1>
            <p class="reveal text-lg md:text-2xl text-slate-500 dark:text-slate-400 max-w-2xl mx-auto mb-12 font-mono leading-relaxed">
                {{ profile.bio|default:"Result-driven developer with 3+ years experience building scalable applications and automating mission-critical banking processes." }}
            </p>
            <div class="reveal flex flex-col sm:flex-row items-center justify-center gap-6">
                <a href="#projects" class="w-full sm:w-auto px-10 py-5 bg-primary text-white rounded-2xl font-bold shadow-2xl shadow-primary/40 hover:scale-105 transition-all flex justify-center items-center group">
                    View Terminal
                    <i data-lucide="chevron-right" class="ml-2 w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                </a>
                <a href="#contact" class="w-full sm:w-auto px-10 py-5 glass rounded-2xl font-bold hover:bg-slate-100 dark:hover:bg-white/5 transition-colors border border-slate-200 dark:border-white/5 text-slate-900 dark:text-slate-100">Initialize Connection</a>
            </div>
        </div>
    </section>

    <section id="about" class="py-32 px-6 reveal">
        <div class="max-w-7xl mx-auto grid lg:grid-cols-2 gap-20 items-center">
            <div class="relative group">
                <div class="absolute -top-10 -left-10 w-40 h-40 bg-primary/20 rounded-full blur-3xl opacity-50 group-hover:opacity-100 transition-opacity"></div>
                <div class="relative glass p-2 rounded-[3.5rem] border border-white/5 overflow-hidden">
                    {% if profile.avatar %}
                        <img src="{{ profile.avatar.url }}" alt="{{ profile.name }}" class="w-full rounded-[3rem] object-cover transition-all duration-500">
                    {% else %}
                        <img src="https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=800&auto=format&fit=crop" alt="Profile" class="w-full rounded-[3rem] object-cover transition-all duration-500">
                    {% endif %}
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-50 dark:from-darkBg via-transparent to-transparent opacity-60"></div>
                </div>
            </div>
            <div>
                <h2 class="text-4xl md:text-5xl font-bold mb-8 font-mono text-slate-900 dark:text-slate-100">whoami</h2>
                <div class="space-y-6 text-slate-600 dark:text-slate-400 font-mono text-sm md:text-base leading-relaxed">
                    {% if profile.about_bullet_1 %}
                        <p><span class="text-primary">&gt;</span> {{ profile.about_bullet_1 }}</p>
                    {% else %}
                        <p><span class="text-primary">&gt;</span> I am a Python Developer specializing in RPA and DevOps Enthusiast.</p>
                    {% endif %}
                    {% if profile.about_bullet_2 %}
                        <p><span class="text-primary">&gt;</span> {{ profile.about_bullet_2 }}</p>
                    {% else %}
                        <p><span class="text-primary">&gt;</span> Skilled in Django, FastAPI, Robocorp, and Docker, with a track record of building secure APIs and high-performance automation bots.</p>
                    {% endif %}
                    {% if profile.about_bullet_3 %}
                        <p><span class="text-primary">&gt;</span> {{ profile.about_bullet_3 }}</p>
                    {% else %}
                        <p><span class="text-primary">&gt;</span> Passionate about clean code, system design, and continuous improvement in automated workflows.</p>
                    {% endif %}
                </div>
                {% if profile.current_company %}
                <div class="mt-12 p-8 glass rounded-3xl border-l-4 border-accent border border-slate-200 dark:border-white/5">
                    <h3 class="font-bold text-accent mb-2">CURRENTLY AT:</h3>
                    <p class="text-xl font-bold text-slate-900 dark:text-slate-100">{{ profile.current_company }}</p>
                    {% if profile.current_role_location %}<p class="text-sm text-slate-600 dark:text-slate-400 opacity-90">{{ profile.current_role_location }}</p>{% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </section>

    <section id="skills" class="py-32 px-6 reveal">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-20">
                <h2 class="text-4xl font-bold font-mono mb-4 text-slate-900 dark:text-slate-100">{{ site_config.skills_section_title|default:"Tech Stack" }}</h2>
                <div class="h-1 w-20 bg-primary mx-auto"></div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                {% for skill in skills_list %}
                <div class="glass p-6 rounded-2xl flex flex-col items-center hover:border-primary/50 transition-colors border border-slate-200 dark:border-white/5">
                    <i class="{{ skill|skill_fa_icon }} text-primary mb-3 text-2xl" aria-hidden="true"></i>
                    <span class="font-mono text-xs text-slate-800 dark:text-slate-200">{{ skill.name }}</span>
                </div>
                {% empty %}
                <div class="glass p-6 rounded-2xl flex flex-col items-center border border-slate-200 dark:border-white/5"><i class="fa-brands fa-python text-primary mb-3 text-2xl" aria-hidden="true"></i><span class="font-mono text-xs text-slate-800 dark:text-slate-200">Python</span></div>
                <div class="glass p-6 rounded-2xl flex flex-col items-center border border-slate-200 dark:border-white/5"><i class="fa-solid fa-robot text-accent mb-3 text-2xl" aria-hidden="true"></i><span class="font-mono text-xs text-slate-800 dark:text-slate-200">Robocorp</span></div>
                <div class="glass p-6 rounded-2xl flex flex-col items-center border border-slate-200 dark:border-white/5"><i class="fa-solid fa-server text-secondary mb-3 text-2xl" aria-hidden="true"></i><span class="font-mono text-xs text-slate-800 dark:text-slate-200">Django/DRF</span></div>
                <div class="glass p-6 rounded-2xl flex flex-col items-center border border-slate-200 dark:border-white/5"><i class="fa-brands fa-docker text-blue-500 mb-3 text-2xl" aria-hidden="true"></i><span class="font-mono text-xs text-slate-800 dark:text-slate-200">Docker</span></div>
                <div class="glass p-6 rounded-2xl flex flex-col items-center border border-slate-200 dark:border-white/5"><i class="fa-solid fa-bolt text-amber-400 mb-3 text-2xl" aria-hidden="true"></i><span class="font-mono text-xs text-slate-800 dark:text-slate-200">FastAPI</span></div>
                <div class="glass p-6 rounded-2xl flex flex-col items-center border border-slate-200 dark:border-white/5"><i class="fa-solid fa-database text-orange-500 mb-3 text-2xl" aria-hidden="true"></i><span class="font-mono text-xs text-slate-800 dark:text-slate-200">PostgreSQL</span></div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section id="projects" class="py-32 px-6 bg-slate-100 dark:bg-slate-900/40">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-end mb-20">
                <div class="reveal">
                    <h2 class="text-4xl md:text-5xl font-bold font-mono text-slate-900 dark:text-white mb-4">{{ site_config.portfolio_section_title|default:"Production Projects" }}</h2>
                    <p class="text-slate-600 dark:text-slate-500 italic font-mono">// mission_critical_deployments</p>
                </div>
            </div>
            <div class="grid lg:grid-cols-2 gap-10">
                {% for project in projects %}
                <div class="glass p-10 rounded-[2.5rem] border border-slate-200 dark:border-white/5 hover:border-primary/50 transition-all reveal">
                    <div class="flex justify-between items-start mb-8">
                        <div class="p-4 bg-primary/10 rounded-2xl text-primary">
                            <i data-lucide="{{ project.icon_name|default:'layers' }}" class="w-6 h-6"></i>
                        </div>
                        <div class="flex gap-2 flex-wrap">
                            {% for tech in project.tech_stack.split %}
                            <span class="px-3 py-1 bg-slate-200 dark:bg-white/5 rounded-full text-[10px] font-mono text-slate-700 dark:text-slate-400">{{ tech|striptags }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <h3 class="text-2xl font-bold mb-4 text-slate-900 dark:text-slate-100">{{ project.title }}</h3>
                    <p class="text-slate-600 dark:text-slate-400 font-mono text-sm leading-relaxed mb-8">{{ project.description }}</p>
                    <div class="flex items-center space-x-6">
                        {% if project.live_link %}
                        <a href="{{ project.live_link }}" target="_blank" rel="noopener" class="text-xs font-bold text-primary flex items-center group">LIVE_URL <i data-lucide="external-link" class="ml-1 w-3 h-3 group-hover:scale-110 transition-transform"></i></a>
                        {% endif %}
                        {% if project.github_link %}
                        <a href="{{ project.github_link }}" target="_blank" rel="noopener" class="text-xs font-bold text-secondary flex items-center group">GITHUB <i data-lucide="chevron-right" class="ml-1 w-3 h-3"></i></a>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <p class="text-slate-600 dark:text-slate-500 col-span-2 italic">No projects added yet. Add from admin.</p>
                {% endfor %}
            </div>
        </div>
    </section>

    <section id="experience" class="py-32 px-6 reveal">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-4xl font-bold font-mono mb-16 text-center text-slate-900 dark:text-slate-100">{{ site_config.experience_section_title|default:"cat career_logs.txt" }}</h2>
            <div class="space-y-12 relative before:absolute before:inset-0 before:left-8 before:h-full before:w-0.5 before:bg-slate-200 dark:before:bg-white/5">
                {% for exp in experiences %}
                <div class="relative pl-20 reveal">
                    <div class="absolute left-6 top-0 w-4 h-4 rounded-full {% if exp.is_primary %}bg-primary ring-8 ring-primary/10{% else %}bg-slate-500 dark:bg-slate-600 ring-8 ring-slate-400/20 dark:ring-slate-600/10{% endif %}"></div>
                    <span class="text-xs font-mono font-bold {% if exp.is_primary %}text-primary{% else %}text-slate-600 dark:text-slate-500{% endif %} mb-2 block uppercase tracking-widest">{{ exp.duration }}</span>
                    <h3 class="text-2xl font-bold text-slate-900 dark:text-slate-100">{{ exp.role }}</h3>
                    <p class="text-slate-600 dark:text-slate-400 italic font-mono mb-4">{{ exp.company }}</p>
                    <div class="text-slate-600 dark:text-slate-500 font-mono text-xs space-y-2 leading-relaxed">{{ exp.description|linebreaks }}</div>
                </div>
                {% empty %}
                <p class="text-slate-600 dark:text-slate-500 italic">No experience entries yet.</p>
                {% endfor %}
            </div>
        </div>
    </section>

    {% if education_list or certifications %}
    <section class="py-32 px-6 reveal">
        <div class="max-w-7xl mx-auto grid lg:grid-cols-2 gap-20">
            {% if education_list %}
            <div>
                <h2 class="text-3xl font-bold font-mono mb-10 flex items-center text-slate-900 dark:text-slate-100"><i data-lucide="graduation-cap" class="mr-3 text-primary w-8 h-8"></i> Education</h2>
                {% for edu in education_list %}
                <div class="glass p-8 rounded-3xl border border-slate-200 dark:border-white/5 mb-6">
                    <span class="text-xs font-mono text-primary font-bold">{{ edu.duration }}</span>
                    <h3 class="text-xl font-bold mt-2 text-slate-900 dark:text-slate-100">{{ edu.degree }}</h3>
                    <p class="text-slate-600 dark:text-slate-400 font-mono text-sm mb-4">{{ edu.institution }}</p>
                    {% if edu.description %}<p class="text-slate-600 dark:text-slate-500 text-xs leading-relaxed">{{ edu.description }}</p>{% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% if certifications %}
            <div>
                <h2 class="text-3xl font-bold font-mono mb-10 flex items-center text-slate-900 dark:text-slate-100"><i data-lucide="award" class="mr-3 text-accent w-8 h-8"></i> Certifications</h2>
                <div class="space-y-4">
                    {% for cert in certifications %}
                    <div class="glass p-5 rounded-2xl flex items-center justify-between border border-slate-200 dark:border-white/5">
                        <div>
                            <h4 class="font-bold text-sm text-slate-900 dark:text-slate-100">{{ cert.title }}</h4>
                            <p class="text-[10px] font-mono text-slate-600 dark:text-slate-500">{{ cert.issuer }}{% if cert.year %} ({{ cert.year }}){% endif %}</p>
                        </div>
                        <i data-lucide="external-link" class="w-4 h-4 opacity-30 text-slate-500"></i>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </section>
    {% endif %}

    {% if recent_posts %}
    <section id="blog" class="py-32 px-6 bg-slate-100 dark:bg-slate-900/30 reveal">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-end mb-20 gap-6">
                <h2 class="text-4xl font-bold font-mono text-slate-900 dark:text-white">Latest from the Blog</h2>
                <a href="{% url 'blog_list' %}" class="text-primary font-bold font-mono text-sm hover:underline">View all &rarr;</a>
            </div>
            <div class="grid md:grid-cols-3 gap-8">
                {% for post in recent_posts %}
                <a href="{% url 'blog_detail' post.slug %}" class="group glass p-8 rounded-3xl border border-slate-200 dark:border-white/5 hover:border-primary/30 transition-all block">
                    {% if post.cover_image %}
                    <img src="{{ post.cover_image.url }}" alt="{{ post.title }}" class="w-full h-40 object-cover rounded-2xl mb-4 group-hover:scale-105 transition-transform">
                    {% endif %}
                    <span class="text-xs font-mono text-slate-600 dark:text-slate-500">{{ post.created_at|date:"M d, Y" }}</span>
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white mt-2 mb-2 group-hover:text-primary transition-colors">{{ post.title }}</h3>
                    <p class="text-slate-600 dark:text-slate-400 text-sm line-clamp-2">{{ post.excerpt }}</p>
                </a>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <section id="contact" class="py-32 px-6">
        <div class="max-w-5xl mx-auto glass rounded-[4rem] p-12 md:p-20 relative overflow-hidden border border-slate-200 dark:border-white/5">
            <div class="absolute -top-24 -right-24 w-96 h-96 bg-primary/10 rounded-full blur-[100px]"></div>
            <div class="grid md:grid-cols-2 gap-20 relative z-10">
                <div>
                    <h2 class="text-5xl font-bold mb-8 text-slate-900 dark:text-slate-100">Initialize <span class="text-primary">Connection</span>.</h2>
                    <p class="text-slate-600 dark:text-slate-400 font-mono text-sm leading-relaxed mb-12">
                        I am currently available for new projects or collaboration inquiries. Send a system request below.
                    </p>
                    <div class="space-y-6 font-mono text-sm text-slate-700 dark:text-slate-300">
                        <div class="flex items-center space-x-4">
                            <i data-lucide="mail" class="text-primary w-5 h-5"></i>
                            <span>{{ site_config.email|default:"" }}</span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <i data-lucide="phone" class="text-accent w-5 h-5"></i>
                            <span>{{ site_config.phone|default:"" }}</span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <i data-lucide="map-pin" class="text-secondary w-5 h-5"></i>
                            <span>{{ site_config.location|default:site_config.address|default:"Kathmandu, Nepal" }}</span>
                        </div>
                    </div>
                    {% if qr_contact_url %}
                    <div class="mt-12 pt-10 border-t border-slate-200 dark:border-white/10">
                        <p class="text-xs font-mono text-slate-500 dark:text-slate-400 mb-3">Scan to add my contact (vCard)</p>
                        <img src="{{ qr_contact_url }}" alt="QR code: add contact" class="w-[120px] h-[120px] rounded-xl bg-white p-2 border border-slate-200 dark:border-white/10 inline-block">
                    </div>
                    {% endif %}
                </div>
                <form id="contact-form" method="post" action="{% url 'contact_submit' %}#contact" class="space-y-6">
                    {% csrf_token %}
                    {{ contact_form.name }}
                    {{ contact_form.email }}
                    {{ contact_form.subject }}
                    {{ contact_form.message }}
                    <button type="submit" class="w-full bg-primary py-5 rounded-2xl font-bold shadow-2xl shadow-primary/30 hover:opacity-90 transition-all font-mono text-white">POST /connect</button>
                </form>
            </div>
        </div>
    </section>
{% endblock %}

{% block extra_js %}
<script>
(function() {
    var form = document.getElementById('contact-form');
    if (!form || typeof Swal === 'undefined') return;
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        var btn = form.querySelector('button[type="submit"]');
        var origText = btn ? btn.textContent : '';
        if (btn) { btn.disabled = true; btn.textContent = 'Sending...'; }
        var formData = new FormData(form);
        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(function(r) { return r.json().then(function(d) { return { ok: r.ok, status: r.status, data: d }; }); })
        .then(function(_r) {
            if (btn) { btn.disabled = false; btn.textContent = origText; }
            if (_r.ok && _r.data.success) {
                Swal.fire({ icon: 'success', title: 'Message sent!', text: _r.data.message, confirmButtonColor: '#6366f1' });
                form.reset();
            } else {
                var msg = _r.data.message || 'Please correct the errors and try again.';
                if (_r.data.errors) {
                    msg = Object.values(_r.data.errors).join(' ');
                }
                Swal.fire({ icon: 'error', title: 'Error', text: msg, confirmButtonColor: '#6366f1' });
            }
        })
        .catch(function() {
            if (btn) { btn.disabled = false; btn.textContent = origText; }
            Swal.fire({ icon: 'error', title: 'Error', text: 'Network error. Please try again.', confirmButtonColor: '#6366f1' });
        });
    });
})();
</script>
{% endblock %}
